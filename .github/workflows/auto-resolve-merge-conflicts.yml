name: Auto Resolve Merge Conflicts

on:
  schedule:
    # Run every hour
    - cron: '0 * * * *'
  workflow_dispatch:  # Allow manual triggering for testing

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  resolve-conflicts:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for all branches
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Resolve merge conflicts
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "::group::Running conflict resolution script"
          bash scripts/resolve_conflicts.sh
          echo "::endgroup::"
      
      - name: Log FlyCI Wingman Context
        if: always()
        run: |
          echo "::group::FlyCI Wingman Diagnostic Info"
          echo "Job Status: ${{ job.status }}"
          echo "Event Name: ${{ github.event_name }}"
          echo "Workflow Permissions - contents: write, pull-requests: write, issues: write"
          echo "GITHUB_TOKEN available: ${{ secrets.GITHUB_TOKEN != '' }}"
          echo "::endgroup::"
      
      - name: FlyCI Wingman
        if: always()
        uses: fly-ci/wingman-action@v1
