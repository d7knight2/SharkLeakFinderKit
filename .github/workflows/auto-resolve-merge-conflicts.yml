name: Auto Resolve Merge Conflicts

on:
  schedule:
    # Run every hour
    - cron: '0 * * * *'
  workflow_dispatch:  # Allow manual triggering for testing

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  resolve-conflicts:
    runs-on: ubuntu-latest
    
    steps:
      - name: Log Debug Information
        run: |
          echo "::group::Environment & Permissions"
          echo "Event Name: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref }}"
          echo "Actor: ${{ github.actor }}"
          echo "Repository: ${{ github.repository }}"
          echo "Workflow Permissions:"
          echo "  - contents: write"
          echo "  - pull-requests: write"
          echo "  - issues: write"
          echo "::endgroup::"
      
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for all branches
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Resolve merge conflicts
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "::group::Running conflict resolution script"
          bash scripts/resolve_conflicts.sh
          echo "::endgroup::"
      
      - name: FlyCI Wingman
        if: always()
        uses: fly-ci/wingman-action@v1
